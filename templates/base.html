{% load static %}

<!doctype html>
    <html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>CRV19 - Home Food Love</title>

        {% include "base/css.html" %}
        {% block base_head %} {% endblock base_head %}


    </head>

    <body>
        {% include "base/navbar.html" with brand_name="Hal's CRV19 Foods" %}

        <div class="container">

            {% block content %}

            {% endblock content %}

        </div>

        {% include "base/js.html" %}

        <script>
            $(document).ready(function(){
                var menuitemForm = $(".form-menuitem-ajax")    // if html id then us #form-menuitem-ajax

                menuitemForm.submit(function(event){
                    event.preventDefault();
                    console.log("Form is not sending")
                    var thisForm = $(this)
                    var actionEndpoint = thisForm.attr("action");
                    var httpMethod = thisForm.attr("method");
                    var formData = thisForm.serialize();    // data into backend package format

                    $.ajax({
                        url: actionEndpoint,
                        method: httpMethod,
                        data: formData,
                        success: function (data) {
                            var submitSpan = thisForm.find(".submit-span")
                            if{data.added}{
                                submitSpan.html("In cart <button type=\"submit\" class=\"btn btn-link\"> Remove this dish?</button>")
                            } else {
                                submitSpan.html(" <button type=\"submit\" class=\"btn btn-success\"> Add to cart </button>")
                                }
                            var navbarCount = $(".navbar-cart-count")
                            navbarCount.text(data.cartItemCount)
                        },
                        error: function(errorData){
                            console.log("Error encountered.  Code is")
                            console.log(errorData)
                        }
                    })

                })
            })
        </script>

    </body>
</html>